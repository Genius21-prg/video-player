<link rel='import' href='../../polymer/polymer-element.html'>
<link rel='import' href='../../polymer/lib/elements/dom-repeat.html'>
<link rel='import' href='3rd-imports/font-awesome.html'>

<link rel='import' href='services/state-manager.html'>
<link rel='import' href='components/video-stream.html'>
<link rel='import' href='components/control-bar/user-controls.html'>


<dom-module id='video-player'>
  <template>
    <style type="text/css">
      :host {
        display: inline-block;
      }
    </style>

    <div id='streams-container'>
      <template is='dom-repeat' items='{{streams}}'>
        <video-stream state='{{state}}' state-manager='{{stateManager}}' url='{{item}}' master='[[_equals(index, 0)]]'></video-stream>
      </template>
    </div>
    <user-controls state='{{state}}' state-manager='{{stateManager}}'></user-controls>
  </template>

  <script>
    class VideoPlayer extends Polymer.Element {
      static get is() { return 'video-player'; }

      static get properties() {
        return {
          streams: {
            type: Array,
            value: []
          },
          state: {
            type: Object,
            value: {
              playState: 'PAUSED',
              position: 0,
              duration: 0,
              playbackRate: 1.0,
              volume: 0.75,
              muted: false
            }
          },
          stateManager: {
            type: Object
          }
        };
      }

      ready() {
        super.ready();
        this.stateManager = new StateManager(this, 'state');
      }

      _equals(a, b) {
        return a === b;
      }
    }

    window.customElements.define(VideoPlayer.is, VideoPlayer);
  </script>
</dom-module>
