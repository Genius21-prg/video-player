<link rel="import" href="../../../bower_components/imd/imd.html">

<link rel="import" href="../../base-element.html">
<link rel="import" href="../styling/control-bar--style-module.html">

<dom-module id="select-control">

  <template>
    <style type="text/css" include="control-bar--style-module">
    </style>

    <div id="container__select_control">
      <!-- Show control as binary switch if there are only 2 values to choose from. -->
      <template is="dom-if" if="{{binarySelection}}">
        <a id="button__select" class="button" on-click="handleButtonClick">
          [[formatter(selectedValue)]]
        </a>
      </template>

      <!-- Show control as dropdown if there are more than 2 values to choose from. -->
      <template is="dom-if" if="{{!binarySelection}}">
        <select id="select__select" on-change="handleSelectionChanged">
          <template is="dom-repeat" items="[[values]]">
            <option value="[[item]]" selected="{{equals(item, selectedValue)}}">[[formatter(item)]]</option>
          </template>
        </select>
      </template>
    </div>
  </template>

  <script>
    define('select-control', ['base-element'], (BaseElement) => {
      class SelectControl extends BaseElement {
        static get is() { return 'select-control'; }

        static get properties() {
          return {
            values: {
              type: Array,
              value: [],
            },
            selectedValue: String,
            formatter: {
              type: Function,
              value: (x) => x,
            },
            binarySelection: {
              type: Boolean,
              computed: '_binarySelection(values)',
            },
          };
        }

        _binarySelection() {
          return this.values && this.values.length === 2;
        }

        handleButtonClick() {
          let index = (this.values.indexOf(this.selectedValue) + 1) % this.selectedValue.length;
          this.setSelectedValue(this.values[index]);
        }

        handleSelectionChanged(e) {
          // Since select element converts values to string, find the value,
          // whose string matches the value of the select element to ensure the
          // correct type.
          let selectedValue = this.values.find(x => x.toString() === e.target.value);
          this.setSelectedValue(selectedValue);
        }

        setSelectedValue(value) {
          this.selectedValue = value;
          this.dispatchEvent(new CustomEvent('change'));
        }
      }

      window.customElements.define(SelectControl.is, SelectControl);
    });
  </script>

</dom-module>
