<link rel='import' href='../../../../polymer/polymer-element.html'>
<link rel='import' href='../../3rd-imports/mobx.html'>
<link rel='import' href='../styling/control-bar--style-module.html'>

<dom-module id='chapters-overview-control'>
  <link rel='import' type='css' href='../../../../components-font-awesome/css/font-awesome.min.css'>
  
  <template>
    <style type='text/css' include="control-bar--style-module">
      :host {
        /* Avoid flickering with changing icons */
        /* It should be about twice the icon size */
        min-width: 3rem;
      } 
      #button__chapters_overview i {
        font-size: 1.5rem;
      }
      #button__chapters_overview.active {
        border: 1px solid yellow;
      }   
    </style>
    
    <div id="container__chapters_overview_control" class="user_controls">
      <a id='button__chapters_overview'><i class='fa fa-list'></i></a>
    </div>
    </template>

  <script>
    (function() {
      const {reaction} = mobx;

      class ChaptersOverviewControl extends Polymer.Element {
        static get is() { return 'chapters-overview-control'; }

        static get properties() {
          return {
            stateManager: {
              type: Object,
              observer: '_updateStateBindings'
            }
          };
        }

        ready() {
          super.ready();
          if (this.stateManager.displayChaptersOverview) {
            this.$.button__chapters_overview.classList.add('active');
          }
          this.$.button__chapters_overview.addEventListener('click', () => this.stateManager.toggleDisplayChaptersOverview());
        }
        
        // functions that are called when the state of the stateManagers properties change
        _updateStateBindings() {
          // Dispose old reactions
          if(this.reactionDisposers) {
            this.reactionDisposers.forEach(disposer => disposer());
          }
          // Register new reactions
          this.reactionDisposers = [
            reaction(() => this.stateManager.displayChaptersOverview, this._displayChaptersOverviewChanged.bind(this))
          ];
        }

        _displayChaptersOverviewChanged(displayState) {
          if (displayState) {
            this.$.button__chapters_overview.classList.add('active');
          }
          else {
            this.$.button__chapters_overview.classList.remove('active');
          }
        }
      }

      window.customElements.define(ChaptersOverviewControl.is, ChaptersOverviewControl);
    })();
  </script>

</dom-module>
