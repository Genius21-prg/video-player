<link rel="import" href="../../bower_components/imd/imd.html">

<link rel="import" href="../base-element.html">
<link rel="import" href="../styling/lists--style-module.html">

<dom-module id="chapter-list">
  <link rel="import" type="css" href="../../bower_components/components-font-awesome/css/font-awesome.min.css">
  <template>
    <style type="text/css" include="lists--style-module">
      #container__chapter_list {
        top: 0;
        right: 0;
        border: 3px solid black;
        @apply --foreground-color;
      }
      #container__chapter_list .list {
        max-width: 250px;
      }
      #container__chapter_list .list_item {
        @apply --background-color
      }
      #container__chapter_list li:nth-child(odd) {
        @apply --secondary-background-color
      }
    </style>

    <div id="container__chapter_list" class="container__list">
      <ul class="list">
          <template is="dom-repeat" items="{{chapters}}">
            <li class="list_item">
              <a class$="link__chapter_bookmark list_item__link [[ifEqualsThen(item, activeChapter, 'active fa-caret-right')]]" on-click="handleClick">
                {{item.text}}
              </a>
            </li>
          </template>
      </ul>
    </div>
  </template>

  <script>
    define('chapter-list', ['base-element'], (BaseElement) => {
      class ChapterList extends BaseElement {
        static get is() { return 'chapter-list'; }

        static get properties() {
          return {
            state: Object,
            stateManager: Object,
            chapters: {
              type: Object,
              value: [],
            },
            activeChapter: Object,
          };
        }

        static get observers() {
          return [
            'updateActiveChapter(chapters, state.position)',
          ];
        }

        handleClick(e) {
          let chapter = e.model.item;
          this.stateManager.setPosition(chapter.seconds);
        }

        updateActiveChapter() {
          this.activeChapter = this.chapters.slice()
                                            .reverse()
                                            .find(chapter => chapter.seconds <= this.state.position);
        }
      }

      window.customElements.define(ChapterList.is, ChapterList);
    });
  </script>

</dom-module>
