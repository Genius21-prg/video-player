<script>
  class StateManager {
    constructor(videoPlayer, statePath) {
      this.videoPlayer = videoPlayer;
      this.statePath = statePath;
    }

    static get PLAYBACK_RATES() {
      return [0.7, 1.0, 1.3, 1.5, 1.8, 2.0];
    }

    get state() {
      return this.videoPlayer[this.statePath];
    }

    setState(path, value) {
      this.videoPlayer.set(this.statePath + '.' + path, value);
    }

    play() {
      this.setState('playState', 'PLAYING');
    }

    pause() {
      this.setState('playState', 'PAUSED');
    }

    togglePlayPause() {
      if(this.state.playState == 'PLAYING') {
        this.pause()
      } else {
        this.play();
      }
    }

    seek(seconds) {
      this.setState('position', seconds);
    }

    setDuration(duration) {
      this.setState('duration', duration);
    }

    setPlaybackRate(playbackRate) {
      this.setState('playbackRate', playbackRate);
    }

    switchPlaybackRate() {
      let newIndex = (StateManager.PLAYBACK_RATES.indexOf(this.state.playbackRate) + 1) % StateManager.PLAYBACK_RATES.length;
      this.setPlaybackRate(StateManager.PLAYBACK_RATES[newIndex]);
    }

    toggleMute() {
      if(this.state.muted) {
        this.unmute()
      } else {
        this.mute();
      }
    }

    mute() {
        this.setState('muted', true);
    }

    unmute() {
        this.setState('muted', false);
    }

    setVolume(volume) {
      // always unmute first to avoid potential inconsistent states between e.g. mute button icon and sound-control-bar
      this.unmute();
      if(volume >= 0 || volume <= 100) {
        this.setState('volume', volume);
      }
    }

    toggleFullScreen() {
      this.setFullScreen(!this.state.fullScreen);
    }

    setFullScreen(fullScreen) {
      this.setState('fullScreen', fullScreen);
    }
  }
</script>
